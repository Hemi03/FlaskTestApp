<!DOCTYPE html>
<html>

<head>
    <title>Home</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src=https://code.jquery.com/jquery-3.5.1.min.js></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
        integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <link href="/static/css/indexStyle.css" rel="stylesheet">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
        integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV"
        crossorigin="anonymous"></script>
</head>

<body>
    <div class="p-3">
        <h2>Basic Table</h2>
        <p class="px-1">A Table of names and addresses:</p>
        <div class="mx-2">
            <table id="nameTable" class="table table-bordered table-hover table-striped">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Address</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
        <button type="button" class="mx-2 btn btn-primary" data-toggle="modal" data-target="#addNewName">
            Add new Name
        </button>
    </div>

    <!-- Modal to add new Name -->
    <div class="modal fade" id="addNewName" tabindex="-1" role="dialog" aria-labelledby="newNameModal"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Configure a new Name</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="form-group">
                            <label for="recipient-name" class="col-form-label">Name:</label>
                            <input type="text" class="form-control" id="newNameInput">
                        </div>
                        <div class="form-group">
                            <label for="message-text" class="col-form-label">Address:</label>
                            <input class="form-control" id="newAddressInput"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="newName()" data-dismiss="modal">Add this
                        Name</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="infoName" tabindex="-1" role="dialog" aria-labelledby="infoNameModal"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="infoNameTitle"></h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="form-group">
                            <label for="recipient-name" class="col-form-label">Name:</label>
                            <input type="text" class="form-control" id="nameInput">
                        </div>
                        <div class="form-group">
                            <label for="message-text" class="col-form-label">Address:</label>
                            <input class="form-control" id="addressInput"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger mr-auto" data-dismiss="modal" data-toggle="modal"
                        data-target="#confirmDeleteName">Delete</button>
                    <button type="button" class="btn btn-primary mr-4">Update Name</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="confirmDeleteName" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Realy?</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>Do you want to delete this Name?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-warning" data-dismiss="modal" onclick="deleteName()">
                        Yes Delete
                    </button>
                    <button type="button" class="btn btn-info" data-dismiss="modal">Cancel</button>
                </div>
            </div>
        </div>
    </div>
</body>

<script>
    function fillNameTable(data) {
        data = JSON.parse(data);
        $("#nameTable > tbody").empty();
        for (var i = 0; i < data.length; i++) {
            var newRow = '<tr data-toggle="modal" data-target="#infoName" data-name="' + data[i][0] + '">';
            newRow += '<td>' + data[i][0] + "</td><td>" + data[i][1] + "</td></tr>";
            $("#nameTable > tbody:last-child").append(newRow);
        };
    };
    function newName() {
        var newName = $("#newNameInput").val();
        var newAddress = $("#newAddressInput").val();
        $("#newNameInput").val("");
        $("#newAddressInput").val("");
        jQuery.post({ url: "/name/" + newName, data: { Address: newAddress } });
        jQuery.ajax({ url: "/name", success: fillNameTable });
    };
    function deleteName() {
        var name = $("#nameInput").val()
        // TODO: handle error
        jQuery.ajax({ url: "/name/" + name, type: "DELETE" });
        jQuery.ajax({ url: "/name", success: fillNameTable });
    }
    function infoModalFilling(data) {
        data = JSON.parse(data);
        $("#nameInput").val(data[0])
        $("#addressInput").val(data[1])
    }
    $('#infoName').on('show.bs.modal', function (event) {
        var name = $(event.relatedTarget).data("name");
        var modal = $(this);
        modal.find(".modal-title").text("Info for: " + name);
        jQuery.getJSON("/name/" + name, infoModalFilling);
    });
    jQuery.getJSON("/name", fillNameTable);
</script>

</html>